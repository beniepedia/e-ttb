import{b as O,r as s,a as t,j as T}from"./app.307ebf12.js";import{M as R,t as S}from"./Main.47df7803.js";import{a as f}from"./index.fefb1b11.js";import{B as k}from"./Button.71786941.js";import"./axios.cd6af229.js";const G=()=>{const{auth:c}=O().props;let w="/images/assets/fail.png",v="/images/assets/success.png",i="/images/assets/loader.gif";const[l,a]=s.exports.useState("CONNECTING..."),[p,n]=s.exports.useState(!1),[m,r]=s.exports.useState(i),[h,u]=s.exports.useState(0),[g,o]=s.exports.useState(!1);s.exports.useEffect(()=>{N()},[]),s.exports.useEffect(()=>{if(h>=5)return U();if(g){let e=setInterval(()=>{C()},5e3);return()=>{clearInterval(e)}}},[g,h]);const C=()=>{f.post(route("whatsapp.status")).then(e=>{e.data.success&&x()}).catch(e=>{console.log("server error"),d()}).finally(()=>{u(e=>e+1)})},N=()=>{n(!0),f.post(route("whatsapp.connect")).then(e=>{u(0);let y=e.data.success,E=e.data.data.qr;if(y){if(!E)return x();r(E),a("SCAN ME"),o(!0)}}).catch(e=>{d()}).finally(()=>{n(!1)})},x=()=>{r(v),a("TERHUBUNG"),o(!1)},d=()=>{r(w),a("SERVER DOWN"),o(!1)},I=()=>{r(i),a("CONNECTING..."),o(!1),u(0)},U=()=>{r(i),a("TIME OUT"),o(!1)},b=()=>{if(c.user.user_type!=="admin"){S.error("Tidak memiliki akses untuk tindakan ini...");return}n(!0),f.delete(route("whatsapp.logout")).then(({data:e})=>{console.log(e),e.success?I():S.error("Terjadi kesalahan saat logout...")}).catch(()=>{d()}).finally(()=>{n(!1)})};return t("div",{className:"my-8 flex justify-center mx-20 md:mx-10",children:T("div",{className:"flex gap-2 flex-col w-full md:w-1/3",children:[T("div",{className:" rounded-lg shadow overflow-hidden",children:[t("img",{src:m,alt:m,className:"border-white bg-slate-100 border-8 w-full"}),t("div",{className:"bg-sky-300 py-4 text-center",children:t("h1",{className:"font-semibold text-xl text-slate-700",children:l})})]}),l=="TIME OUT"||l=="CONNECTING..."?t(k,{className:"btn-success mt-3",handleClick:()=>N(),processing:p,children:"Reconnect"}):"",l=="TERHUBUNG"&&t(k,{className:"btn-error mt-3",handleClick:()=>b(),processing:p,children:"LOGOUT"})]})})};G.layout=c=>t(R,{auth:c.props.auth,children:c});export{G as default};
